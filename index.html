<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Icicles</title>
    <meta
      name="description"
      content="simulation of dripping christmas lights"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/bulmaswatch/cyborg/bulmaswatch.min.css"
    />
  </head>

  <body>
    <section class="section">
      <div class="tile is-ancestor">
        <div class="tile is-vertical is-8">
          <div class="tile">
            <div class="tile is-parent">
              <div class="tile is-child box has-text-centered">
                <svg
                  class="image is-inline-block"
                  width="270"
                  height="360"
                ></svg>
              </div>
            </div>
            <div class="tile is-parent is-vertical">
              <article class="tile is-child notification is-info">
                <p class="title">Positions</p>
                <ul
                  style="
                    font-family: monospace;
                    text-align: right;
                    list-style-type: none;
                  "
                  id="positions"
                ></ul>
              </article>
              <article class="tile is-child notification is-warning">
                <p class="title">Time</p>
                <span style="font-family: monospace;" id="time"></span>ms
              </article>
            </div>
          </div>
          <div class="tile is-parent">
            <article class="tile is-child notification is-danger">
              <!--
              <div class="field">
                <label class="label">Jump to time</label>
                <div class="control">
                  <div class="field has-addons">
                    <div class="control">
                      <input
                        id="jump"
                        class="input"
                        type="text"
                        placeholder="time in ms..."
                      />
                    </div>
                    <div class="control">
                      <button class="button" onclick="jump();">Go!</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="field">
                <label class="label">Start autoplay</label>
                <div class="control">
                  <div class="field has-addons">
                    <div class="control">
                      <input
                        id="autoSpeed"
                        class="input"
                        type="text"
                        placeholder="ms per frame..."
                      />
                    </div>
                    <div class="control">
                      <button class="button" onclick="auto(this);">
                        Start
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="field">
                <label class="label">Icicle rates (in <span style="font-family: monospace;">positions / ms</spab>)</label>
                <div class="field is-grouped is-grouped-multiline">
                  <p class="control">
                    <input
                      class="input"
                      id="rate-0"
                      type="text"
                      placeholder="Auto rate..."
                    />
                  </p>
                  <p class="control">
                    <input
                      class="input"
                      id="rate-1"
                      type="text"
                      placeholder="Auto rate..."
                    />
                  </p>
                  <p class="control">
                    <input
                      class="input"
                      id="rate-2"
                      type="text"
                      placeholder="Auto rate..."
                    />
                  </p>
                  <p class="control">
                    <input
                      class="input"
                      id="rate-3"
                      type="text"
                      placeholder="Auto rate..."
                    />
                  </p>
                  <p class="control">
                    <input
                      class="input"
                      id="rate-4"
                      type="text"
                      placeholder="Auto rate..."
                    />
                  </p>
                  <p class="control">
                    <button class="button" onclick="setRates();">Set</button>
                  </p>
                </div>
              </div>

              <div class="field">
                <label class="label">Presets</label>
                <div class="field is-grouped is-grouped-multiline">
                  <p class="control">
                    <button class="button" onclick="activatePreset(0);">Hundredths</button>
                  </p>
                  <p class="control">
                    <button class="button" onclick="activatePreset(1);">Thousandths</button>
                  </p>
                  <p class="control">
                    <button class="button" onclick="activatePreset(2);">Whole numbers</button>
                  </p>
                  <p class="control">
                    <button class="button" onclick="activatePreset(3);">1 point something</button>
                  </p>
                </div>
              </div> 
              -->
            </article>
          </div>
        </div>

        <div class="tile is-parent">
          <nav
            class="panel tile is-child is-success"
            style="background-color: #363636"
          >
            <p class="panel-heading">Synced</p>
            <p class="panel-tabs">
              <a class="is-active">Moments</a>
            </p>
            <div class="panel-block">
              <ul
                style="max-height: 730px; overflow: scroll; width: 100%"
                id="ranges"
              ></ul>
            </div>
          </nav>
        </div>
      </div>
    </section>

    <script src="views.js"></script>
    <script src="icicle.js"></script>
    <script src="clock.js"></script>
    <script src="visualisation.js"></script>
    <script src="keyboard.js"></script>
    <script src="data.js"></script>
    <script>
      let positions = [0, 0, 0, 0, 0];
      let rates = [0.016, 0.016, 0.016, 0.016, 0.016];
      let time = 0;

      visualisation.init();

      let update = (change) => {
        time += change;

        const { offsets, positions } = icicle.calculatePositions(rates, time);

        visualisation.render(offsets);
        data.render(time.toFixed(2), positions);
      };

      const timer = clock.timer(undefined, (millis) => update(millis));

      keyboard.bindArrows((change) => update(62.5 * change));
      keyboard.bindSpace(() => timer.toggle());

      update(0);

      // activatePreset(0);
      // let clock = model.clock(icicles.calculatePositions, render);
    </script>
  </body>
</html>
